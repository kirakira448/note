上一节课《[微信支付宝的开发者为什么都用它来演示对接](http://mp.weixin.qq.com/s?__biz=MzUzNTY5MzU2MA==&mid=2247500291&idx=1&sn=80ee7773c12a7f0a4e1d478e866caf1e&chksm=fa831394cdf49a82ef67895450e9b3161e1cb714cc198ea91096ac4451788cf31226f621b8dd&scene=21#wechat_redirect)》我们了解到在开发文档和SDK使用说明中经常会使用顺序图演示系统的对接和集成，我们通过一些实际的例子讲解了顺序图的语法，教给大家如何看懂像微信支付、支付宝开发对接文档中的那些顺序图。

顺序图是研发人员做技术评审时使用频率非常高的一个UML图形，所以光看懂还不够，我们还要学会怎么在平时的实践中用顺序图表达出自己想要给其他人表达的逻辑，这样在像技术评审这样的环节中大家就能迅速建立共识，同时也有助于自己团队的业务和技术沉淀，避免出现人员更新迭代后谁都说不清楚某块的业务逻辑，只能硬抠代码喂自己的惨痛情况。

所以本节我会专门花一节课的时间教大家怎么使用绘图软件一步一步地把顺序图画出来，同时也会把画顺序图的要点给大家说一下。

这节课演示使用的例子就是在上节课中我们用到的表达会员自动续费业务的服务交互逻辑的顺序图。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/1.jpg)

为什么使用这个例子呢？主要是这个例子说的会员自动续费大家在日常生活中都有接触过，或多或少都充过爱奇艺会员，还有一点是这个流程刚好能够让我们把顺序图的常用语法在表达他的业务逻辑时都用一遍。

有关顺序图的常用语法和绘图时怎么让整体布局更清晰、更容易被人读懂的经验细节我们在上节课有详细分享过，推荐大家把先把[上节讲的内容](http://mp.weixin.qq.com/s?__biz=MzUzNTY5MzU2MA==&mid=2247500291&idx=1&sn=80ee7773c12a7f0a4e1d478e866caf1e&chksm=fa831394cdf49a82ef67895450e9b3161e1cb714cc198ea91096ac4451788cf31226f621b8dd&scene=21#wechat_redirect)消化完后再来开始跟着本节进行动手实战。


## 要用顺序图表达的逻辑

这里再把这个顺序图要表达的逻辑给大家用文字概述一下，其实上节课已经说过一遍，防止大家上节那部分的内容没细看就在这个跟着画，我还是再把这张图要表达的业务逻辑再说一遍。

会员的自动续期这个业务相信大家都能理解，我们开的爱奇艺、腾讯视频会员或者B站大会员时都有一个选项叫“自动连续续费”，属于做订阅类的业务常见的一种营收策略，“自动连续续费”单价会低一些，但是会员的留存时间会更长（毕竟有人开通后会忘记取消这个选项）。

所以这种业务一般都会有个自动续期管理服务，每天会跑数据把快要到期的会员生成自动续费任务，再调用会员内部的服务进行续费。会员服务内部也是生成订单、再去调用支付中台、由支付中台再调用微信或者支付宝银行卡等支付通道进行扣费。

> 这里说点题外话，我在这里举例的营收模式比较符合市场监管的规定和大家的三观，但是大家可能没想到的是国内大部分互联网金融和保险公司都是靠这种自动扣费的方式活下去的，为了能多扣钱会各种无底线操作引导你签约。
> 
> 这里提醒一下大家微信和云闪付的自动扣费尽量别开，它们的限制很松甚至能用A商品的签约码把B商品的钱给你扣了......
> 
> 还在互金公司的时候接触过非常多这样的东西，导致自己对那份工作产生的社会价值及其不认可。

上面是给大家一个额外的小提醒，咱们言归正传。

## 顺序图实战指南

首先跟在流程分析中使用活动图时一样，我们在画顺序图分析流程的时候也是应该先确定流程的参与者有哪些。在顺序图中每个参与者都叫做“角色”，角色常见的有三种画图风格：小公仔、对象方框或者是圆形的实体，我们在上节课的三例子中也是分别用了三种不同风格。

在我们的绘图软件 draw.io 中，左侧绘图元素区的UML菜单栏下，也正好有这几种风格供我们选择使用，具体的位置我已经在下图里给大家标注好啦。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/2.jpg)

draw.io 里是把角色和它对应的生命线合并在一起提供给我们的，这样就省得我们自己再去单独在角色下面拉出来一根垂直虚线来当生命线了。

我个人的画图风格是比较喜欢对象框风格的角色，无论参与流程的角色是人、拟人的事物还是某个模块之类的概念性的东西都能使用它来表示。

画在生命线上的那些细长矩形框叫做“会话”，每个会话表示角色间的一次交互。

在 draw.io 里我们鼠标单击选中会话框然后把它拖拽到生命线上时，画布上会自动识别（如下图），让我们在生命线上放置会话框。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/3.jpg)

顺序图里表示角色之间在会话中进行交互，是使用的消息和返回值图标，消息用的是实体箭头线段而返回值是虚线箭头线段，这两个绘图元素的位置我也都给大家在下图中标注出来了。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/4.jpg)

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/5.jpg)

会话中还有一种情况，表示角色自己处理逻辑的自调用会话框，也会经常用到，它能帮我们标明会话里角色自己做的事情。

需要用到自调用会话框时，我们可以像下图标注的这样选择自调用会话框，把它拖拽到大会话框附近后 draw.io 会自动识别让我们放置上去，然后可以在自调用会话框的消息箭头上标明自调用的逻辑。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/6.jpg)

除了自调用会话框，draw.io在顺序图的绘图元素里还有回调消息框，支持我们表达服务器的异步回调逻辑。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/7.jpg)

我们在这里演示的例子中没有异步回调逻辑，不过在上一节给出的支付平台下单流程的UML顺序图中有使用到，大家可以回看那个例子。

接下来我们继续画我们的顺序图，当流程中遇到了循环而且这个循环逻辑比较关键，需要在顺序图中表达出来的时候我们就要用到顺序图里的循环框了，这个元素没有现成的。draw.io里只给我提供了基础的frame框。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/8.jpg)

我们用frame框住表达循环逻辑的会话部分，然后把frame框的名字改成loop就是顺序图循环逻辑的语法了。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/9.jpg)

通常我还会在旁边挂一个注释，辅助说明一下循环流程的逻辑细节。

同理，如果流程的某个分支选择逻辑比较关键需要在顺序图中表达出来的时候我们也是用frame框把图中涉及到分支选择的会话框部分框住，frame框的名字改成alt ( 是alternative 这个单词的缩写，这个单词的意思是可供选择的事物)。

表达流程中的分支选择，在frame框中还要用虚线把分支相互隔开，并在每个区块中用类似活动图守护的语法标明满足进入该分支的条件，比如下图的[有可用优惠券], [无可用优惠券]。

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/10.jpg)

我们在用顺序图分析流程的时候，如果不是特别关键的循环和分支选择子流程尽量的话，可以不表达出来，因为顺序图的 loop 框和 alt 框用多了的话就会很难让人看懂。

至此我已经把这个示例顺序图的画图要领都给大家讲了一遍了，并且都做了图解，大家动手练起来吧。这个顺序图我已经在draw.io网页端共享出来了，大家访问下面这个链接即可拿来参考。

https://drive.google.com/file/d/18MAOIC2yflyr5fWsLA0lqTcHlZ89zpOL/view?usp=sharing

访问页面后点击页面上方的在draw.io打开即可

![图片](设计/程序员画图/img/11_手把手教你画出大厂开放平台中的顺序图/11.jpg)

使用离线版客户端的，请访问下面这个仓库下载源文件，下载后使用draw.io客户端直接打开就可以。 https://github.com/kevinyan815/developer-omni-illustration-tutorial

## 总结

到这里我们把需求分析和技术评审中用来做结构建模的类图，做行为建模的活动图、状态机图、顺序图都讲完了，如果你只学到这里已经能覆盖你日常工作中大部分需要画图的场景了，再往后就是更高阶的内容比如架构图、程序设计图之类的。

下节课开始我花两节课把怎么用他们做好技术评审给大家详细讲讲，把现在讲的这些巩固了能在实际工作中用起来之后再继续学后面高阶的内容。