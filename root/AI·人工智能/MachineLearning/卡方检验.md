#### 卡方统计量
$$
χ^2=\frac{∑(A-E)^2}{E}
$$
A为实际频数，E为期望频数（理论频数）。

- 当观察频数与期望频数完全一致时，卡方值为0
- 观察频数与期望频数越接近，两者之间的差异越小，卡方值越小
- 观察频数与期望频数差异越大，卡方值越大
- 卡方值的大小也和自由度有关

代码实现：
```python
import pandas as pd
import statsmodels.stats.contingency_tables as tbl

income_car_table=pd.crosstab(home.Ts9,home.O1,margins=True)

# 传入数据
table=tbl.Table(income_car_table)

res=table.test_nominal_association()    # 卡方检验
print("卡方值：",res.statistic)
print("自由度：",res.df)
print("p值：",res.pvalue)   # 格式化后的p值
```

## McNemar's检验（配对卡方检验）

分析**两个相关率的变化是否有统计学意义**

![[McNemar.png]]

分析思路：

- H~0~假设：两种方法阳性检出率无差别，即b单元格=c单元格
- 对同一个体，分别有两次不同的测量，并最终构成了两组数据，因此研究框架是自身配对设计
- 求出各对的差值，然后考察样本中差值的分布是否按照H~0~假设的情况对称分布
- 主对角线上的样本，两种检验方法的结论相同（a和d的结果，对于A、B方法无差异）
- 非主对角线上的单元格才携带检验方法的差异信息
- 根据H~0~得到b、c两格的理论数均为(b+c)/2,对应的配对检验统计量，经过化简后是：
$$
χ^2=\frac{(b-c)^2}{b+c}
$$
一般在 b + c < 40 时，需用确切概率法进行检验，或者进行校正

代码实现：
- 用SquareTable类分析
	- tbl.SquareTable 用于分析行列变量类别相同的对称结构方表（近似结果）
```python
import numpy as np
import statsmodels.stats.contingency_tables as tbl
# 必须为方阵结构数据
table = tbl.SquareTable(np.array([[56, 35], [21, 28]])) 
print(table.summary())  # 打印汇总信息
print(table.symmetry()) # 只打印symmetry

```
- 用mcnemar类分析
	- tbl.mcnemar 用于分析配对四格表（确切概率结果，在样本较小(<40)时使用）
```python
import statsmodels.stats.contingency_tables as tbl
table = tbl.mcnemar(pd.DataFrame([[56, 35], [21, 28]]))
print(table.pvalue) # 确切概率结果
```

