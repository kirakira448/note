*Amazon Elastic Flie System*
# 基本介绍
## 功能
一种简单的弹性[[文件存储]]系统。
Amazon EFS 非常适合支持广泛的使用案例。
例如：无服务器应用程序的储存、Web服务和内容管理、应用程序开发和测试、数据库备份。

![[imgs/Pasted image 20230812171029.png]]

### 完全托管
一种完全托管服务。
由 AWS 负责管理文件服务器、更新关键、设定软件或执行备份等。
### 高可用性与耐用性
EFS 将每个文件系统对象（目录、文件和连接）冗余地存放在多个可用区域中。
使用 Standard 存储级别。
### 弹性与可扩展性
存储容量会随着新增和移除文件而自动扩展和缩减。
输送量和 IOPS 可随着文件系统增长而扩充。
### 数据加密
静态数据使用 AWS Key Management Service (AWS KMS) 管理的加密密钥进行透明式加密。
传输中的数据加密使用 Transport Layer Security (TLS) 来保护网络流量。


# 使用
## 将实例接入EFS
### 1.创建安全组
1. 在 EC2 界面中，选择`安全组`选项
2. 点击`创建安全组`
	1. 基本信息
		1. 命名
		2. 描述
		3. vpc 选择实例所在vpc
	2. 入站规则
		1. **类型：NFS**
		2. 源：选择webserver（这里的webserver是安全组中已经设置过的规则）
	3. 创建安全组
## 2.创建文件系统
1. 在 EFS 界面中，选择`创建文件系统`
	1. 命名
	2. VPC 选择实例所在VPC
	3. 点击`自定义`
		1. 取消勾选`启动自动备份`
		2. 转换为IA 设置为`无`
		3. 点击`下一步`
		4. 清除其他挂载目标
		5. 挂载当前可用区，清除默认安全组，选择第一步创建的安全组。
		6. 点击`下一步`，点击`创建`
	4. 如果向已经存在的文件系统添加新的挂载
		1. 点击当前文件系统
		2. 选择网络选项
		3. 点击`管理`
			1. `添加挂载目标`
			2. 选择要添加的可用区、子网ID、安全组
			3. 保存
### 3.挂载
1. 点击上一步创建的文件系统
2. 点击连接
	1. 在`通过DNS挂载`选项下，复制`使用EFS挂载帮助程序`的代码
	2. 例：`sudo mount -t efs -o tls fs-0041219653f153f8d:/ efs`
3. 返回 EC2 界面
4. 选中要挂载的实例，点击`连接`
5. 在`会话管理器`选项下，点击`连接`
安装工具
```shell
sudo -i
sudo yum install -y amazon-efs-utils
```
创建目录
```shell
mkdir data
ls
```
执行之前复制的命令，将尾部的 efs 替换为刚刚创建的目录 data。
如果失败，请检查EFS的网络设置中，是否挂载了当前的可用区。
```shell
sudo mount -t efs -o tls fs-0041219653f153f8d:/ data
```
创建日志文件
`efs-1 mounted in site A`请根据当前站点修改‘A’
```shell
cd data
sudo bash -c "cat >> efs-l-setup.log"

efs-1 mounted in site A

^C
```
查看日志文件
```shell
cat efs-1-setup.log
```